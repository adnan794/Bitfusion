package src{	import flash.display.Loader;	import flash.display.MovieClip;	import flash.display.Sprite;	import flash.display.Stage;	import flash.display.StageAlign;	import flash.display.StageScaleMode;	import flash.display.StageDisplayState;	import flash.events.FullScreenEvent;	import flash.events.MouseEvent;	import flash.events.TimerEvent;	import flash.external.ExternalInterface;	import flash.net.URLRequest;	import flash.text.TextField;	import flash.utils.Timer;	import flash.events.Event;	import flash.events.IOErrorEvent;	import flash.system.*;			public class Application extends Sprite	{		private var _flvURL;String;		private var _errorShowing:Boolean = false;		private var _firstTimeError:Boolean = true;		private var _timer:Timer;		private var _fullScreen:Boolean = false;		private var videoControls:MovieClip;		private var _imageURL:String;		private var _nam:String;		private var _email:String;		private var _hotelDomain:String;		private var _duration:Number;		private var loaderContext:LoaderContext;				//private var _fullScreen:Boolean = f;		//private var _errorClip:ErrorClip;		public function Application()		{			trace("Created");												init();			//playCuePoint();		}		private function init()		{			if(root.loaderInfo.parameters["flvURL"] != null)				_flvURL = root.loaderInfo.parameters["flvURL"];			else				_flvURL = "assets/flv/test.flv";							if(root.loaderInfo.parameters["imageURL"] != null)				_imageURL = root.loaderInfo.parameters["imageURL"];			else				_imageURL = "assets/images/test.jpg";							if(root.loaderInfo.parameters["name"] != null)				_nam = root.loaderInfo.parameters["name"];			else				_nam = "Mr Test";							if(root.loaderInfo.parameters["email"] != null)				_email = root.loaderInfo.parameters["email"];			else				_email = "test@test.co.uk";													if(root.loaderInfo.parameters["hotelDomain"] != null)				_hotelDomain = root.loaderInfo.parameters["hotelDomain"];			else				_hotelDomain = "http://www.bw-isite.co.uk/sendvideo.aspx";							if(root.loaderInfo.parameters["duration"] != null)				_duration = root.loaderInfo.parameters["duration"];			else				_duration = 553326;														   Security.loadPolicyFile('http://ddpuuwqw7k32q.cloudfront.net/crossdomain.xml'); // was // http://api.facebook.com/crossdomain.xml            Security.allowDomain("http://ddpuuwqw7k32q.cloudfront.net/", "http://preview.amaze.com/", "http://www.bit-fusion.co.uk/");            Security.allowInsecureDomain("http://ddpuuwqw7k32q.cloudfront.net/", "http://preview.amaze.com/", "http://www.bit-fusion.co.uk/");            //Security.allowDomain( "fbcdn.net", "www.facebook.com", "facebook.com", "photos-a.ak.fbcdn.net" , "*.fbcdn.net", "*" );            //Security.loadPolicyFile( "exampledomain.com/crossdomain.xml" );            loaderContext= new LoaderContext();            loaderContext.checkPolicyFile = true;            loaderContext.applicationDomain = ApplicationDomain.currentDomain;			 /**/setupImage();			stage.scaleMode	= StageScaleMode.NO_SCALE;            stage.align		= StageAlign.TOP_LEFT;			stage.addEventListener(FullScreenEvent.FULL_SCREEN, onFullscreen);            Container.getInstance().x = 0;			Container.getInstance().y = 0;			addChild(Container.getInstance());			videoControls = Transporter.getInstance();			videoControls.x = 5;		    videoControls.y = 212;			addChild(videoControls);		}		private function setupImage()		{			var loader:Loader = new Loader;			loader.contentLoaderInfo.addEventListener(IOErrorEvent.IO_ERROR, ioErrorHandler);			loader.contentLoaderInfo.addEventListener(Event.COMPLETE, displayImage);						loader.load(new URLRequest(_imageURL), loaderContext);			        }					 private function ioErrorHandler(event:IOErrorEvent):void {            trace("Fucking Error is here: " + event);			 //   Container.getInstance().addChild(e.target.content);				//setupVideoPlayer();				//Container.getInstance().showHide(true);        }				private function displayImage(e:Event) {				trace(e.target.content);							  							  Container.getInstance().addChild(e.target.content);			  Container.getInstance().resize(0,0,640,360);			  setupVideoPlayer();			  Container.getInstance().showHide(true);							}					private function setupVideoPlayer(){			VideoPlayer.getInstance().video();			VideoPlayer.getInstance().videoDimensions(0,0,640,360);			videoContainer.addChild(VideoPlayer.getInstance());			//videoContainer.visible = false;			//addChild(VideoContainer.getInstance());			//VideoPlayer.getInstance().playVideo(_flvURL);						videoControls.playButtonState();		    VideoPlayer.getInstance().displayTotalTime(_duration/1000);						//videoContainer.visible = true;						//videoControls.mcFeatures.mcFullScreen.addEventListener(MouseEvent.CLICK, onFullScreenClicked);		}				public function onFullScreenClicked() {						if (this.stage.displayState == StageDisplayState.FULL_SCREEN)             this.stage.displayState = StageDisplayState.NORMAL;			else             this.stage.displayState=StageDisplayState.FULL_SCREEN;		}				public function onFullscreen(e:FullScreenEvent = null):void {			if (e.fullScreen) {				_fullScreen = true;				videoControls.x = (Capabilities.screenResolutionX - 640) / 2;				videoControls.y = (Capabilities.screenResolutionY - 142);				VideoPlayer.getInstance().videoDimensions(0, 0, stage.fullScreenWidth, stage.fullScreenHeight);				videoControls.mcFeatures.closePanel();				checkImage();	    } else {				_fullScreen = false;				videoControls.x = 5;				videoControls.y = 212;				checkImage();				videoControls.mcFeatures.closePanel();				VideoPlayer.getInstance().videoDimensions(0, 0, 640, 360);					if (this.contains(this.getChildByName("email"))){				this.getChildByName("email").x = 187.5;				this.getChildByName("email").y = 110;				}	    }}		private function playCuePoint(val:String){			var txt:TextField = new TextField;			txt.wordWrap = true;			txt.text = "This has been sent from flash " + val;			//addChild(txt);			//Container.getInstance().jumpToCuePoint(val);		}				public function showError(){			if(_firstTimeError){				/*_firstTimeError = false;				_timer = new Timer(3000);				_errorClip = new ErrorClip;				_errorClip.x = 184.80;				_errorClip.y = 139.20;				*/			}						if(_errorShowing){				trace("Already showing error don;t do anything")			}			else{								_errorShowing = true;				_timer.addEventListener(TimerEvent.TIMER, onTimer);			    _timer.start();				//addChild(_errorClip);			}					}		private function onTimer(e:TimerEvent){			_errorShowing = false;			_timer.removeEventListener(TimerEvent.TIMER, onTimer);			_timer.stop();			//this.removeChild(_errorClip);		}				public function disableInterface() {			trace("MAIN EMAIL");			videoControls.mcFeatures.closePanel();			videoControls.mouseEnabled = false;			videoControls.mouseChildren = false;			VideoPlayer.getInstance().disableVideo();			if (Container.getInstance().isShowing())			Container.getInstance().alpha = 0.4;						}				public function enableInterface() {			trace("MAIN EMAIL");							Container.getInstance().alpha = 1;			    Container.getInstance().showHide(false);				videoControls.mouseEnabled = true;			    videoControls.mouseChildren = true;										    VideoPlayer.getInstance().enableVideo();									this.removeChild(this.getChildByName("email"));					}				public function addEmailToStage() {			if (_fullScreen)			{			  var obj:Object = this.getChildByName("email");			  if(obj!=null){				  obj.showError();			  }			   this.getChildByName("email").x = (Capabilities.screenResolutionX - 265) / 2;			   this.getChildByName("email").y = (Capabilities.screenResolutionY - 140) / 2;			   			   									}			else {				this.getChildByName("email").x = 187.5;				this.getChildByName("email").y = 110;			}					}				public function checkImage():void 		{						if (_fullScreen)			Container.getInstance().resize(0,0,stage.fullScreenWidth, stage.fullScreenHeight);			else 			Container.getInstance().resize(0,0,640, 340);		}				public function get nam():String{			return _nam;		}		public function get email():String{			return _email;		}		public function get hotelDomain():String{			return _hotelDomain;		}				public function playVideo()		{			VideoPlayer.getInstance().playVideo(_flvURL);		}					}}